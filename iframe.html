<html>
  <head>
    FB Iframe Token Test Page
  </head>
  <body>
    <script>
      const d = new Date();
      const frameId = "fb_iframe";
      // Insert FB IFrame
      try {
        const fbIframe = document.createElement('iframe');
        fbIframe.id = frameId;
        fbIframe.src = 'https://www.xqyin.sb.facebook.com/audiencenetwork/token/v1/';
        document.body.appendChild(fbIframe);
      } catch (e) {
        console.error(e);
      }

      // Call for sending token request
      function requestToken() {
        const fbIfr = document.getElementById(frameId);
        // FB server will validate if the message is matched with "GET_FB_TOKEN_{platformid}"
        fbIfr.contentWindow.postMessage("GET_FB_TOKEN_289474681496410", "https://www.xqyin.sb.facebook.com");
      };
      // Send token request every 2 secs
      window.setInterval(requestToken, 2000);

      // Callback after receiving token
      function receiveFBToken(event) {
        console.log('received token from FB iframe',);
        console.log(event.data);
      };
      // Listen to message event for token response
      window.addEventListener("message", receiveFBToken, false);
    </script>
  </body>
</html>
